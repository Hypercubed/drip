/*!
 * drip - Node.js event emitter.
 * Copyright(c) 2011 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */

!function(a,b){typeof module!="undefined"?module.exports=b():typeof define=="function"&&typeof define.amd=="object"?define(b):this[a]=b()}("drip",function(){function c(a){a&&(this._drip={},this._drip.delimeter=a.delimeter||":",this._drip.wildcard=a.wildcard||(a.delimeter?!0:!1))}function d(a,b){var c=this._drip||(this._drip={}),d=c.memoize||(c.memoize={}),f=c.delimeter&&Array.isArray(a)?a.join(c.delimeter):a,g=d[f],h=null;if(!g)h=e(f,b),d[f]=[[b,h]];else{for(var i=0,j=g.length;i<j;i++)if(g[i][0]===b)return g[i][1];h=e(f,b),g.push([b,h])}return h}function e(a,b){return function(){var d=Array.prototype.slice.call(arguments),e=[a].concat(d);b.emit.apply(b,e)}}var a={},b=a.exports=c;return b.version="0.2.4",c.prototype.on=function(a,b){if(!this._drip||this._drip&&!this._drip.wildcard){var c=this._events||(this._events={});c[a]?"function"==typeof c[a]?c[a]=[c[a],b]:c[a].push(b):c[a]=b}else if(this._drip&&this._drip.wildcard){var d=Array.isArray(a)?a:a.split(this._drip.delimeter),e=this._events||(this._events={});function f(a,c){var d=a.shift();c[d]=c[d]||{},a.length?f(a,c[d]):c[d]._?c[d]._.push(b):c[d]._=[b]}f(d,e)}return this},c.prototype.many=function(a,b,c){function e(){--b===0&&d.off(a,e),c.apply(null,arguments)}var d=this;return this.on(a,e),this},c.prototype.once=function(a,b){return this.many(a,1,b),this},c.prototype.off=function(a,b){if(!this._events||arguments.length===0)return this._events={},this;if(!this._drip||this._drip&&!this._drip.wildcard){if("function"!=typeof b)return this._events[a]=null,this;var c=this._events[a];if(!c)return this;if("function"==typeof c&&c==b)this._events[a]=null;else if(Array.isArray(c)){for(var d=0;d<c.length;d++)c[d]==b&&c.splice(d,1);c.length===0?this._events[a]=null:c.length===1&&(this._events[a]=c[0])}}else{var e=Array.isArray(a)?a:a.split(this._drip.delimeter);if(e.length===1)return this._events[a]&&(this._events[a]._=null),this;function f(a){for(var b in a)if(a[b]&&b!="_")return!1;return!0}function g(a){if(b&&"function"==typeof b){for(var c=0;c<a._.length;c++)b==a._[c]&&a._.splice(c,1);a._.length===0&&(a._=null),a._&&a._.length==1&&(a._=a._[0])}else a._=null;return!a._&&f(a)&&(a=null),a}function h(a,b){var c=a.shift();return b[c]&&b[c]._&&!a.length&&(b[c]=g(b[c])),b[c]&&a.length&&(b[c]=h(a,b[c])),!b[c]&&f(b)&&(b=null),b}this._events=h(e,this._events)}return this},c.prototype.removeListener=c.prototype.off,c.prototype.removeAllListeners=c.prototype.off,c.prototype.emit=function(){if(!this._events)return!1;var a=arguments[0],b;if(!this._drip||this._drip&&!this._drip.wildcard)b=this._events[a];else{var c=Array.isArray(a)?a:a.split(this._drip.delimeter),d=arguments.length,e=new Array(d-1);b=[];function f(a,c){var d=a.shift();d!=="*"&&c[d]&&c[d]._&&!a.length&&("function"==typeof c[d]._?b.push(c[d]._):b=b.concat(c[d]._)),c["*"]&&c["*"]._&&!a.length&&("function"==typeof c["*"]._?b.push(c["*"]._):b=b.concat(c["*"]._)),a.length&&(c[d]&&f(a.slice(0),c[d]),c["*"]&&f(a.slice(0),c["*"]))}f(c,this._events)}if(!b)return!1;if("function"==typeof b)if(arguments.length==1)b.call(this);else if(arguments.length==2)b.call(this,arguments[1]);else if(arguments.length==3)b.call(this,arguments[1],arguments[2]);else{var g=arguments.length,e=new Array(g-1);for(var h=1;h<g;h++)e[h-1]=arguments[h];b.apply(this,e)}else{for(var i=1;i<d;i++)e[i-1]=arguments[i];for(var h=0,g=b.length;h<g;h++)e.length===0?b[h].call(this):e.length===1?b[h].call(this,e[0]):e.length===2?b[h].call(this,e[0],e[1]):b[h].apply(this,e)}return!0},c.prototype.has=function(a,b){if(!this._events)return!1;var a=arguments[0],c;if(!this._drip||this._drip&&!this._drip.wildcard)c=this._events[a];else{var d=Array.isArray(a)?a:a.split(this._drip.delimeter);c=[];function e(a,b){var d=a.shift();d!=="*"&&b[d]&&b[d]._&&!a.length&&("function"==typeof b[d]._?c.push(b[d]._):c=c.concat(b[d]._)),b["*"]&&b["*"]._&&!a.length&&("function"==typeof b["*"]._?c.push(b["*"]._):c=c.concat(b["*"]._)),a.length&&(b[d]&&e(a.slice(0),b[d]),b["*"]&&e(a.slice(0),b["*"]))}e(d,this._events)}return c?!b&&"function"==typeof c?!0:b&&"function"==typeof c&&b==c?!0:c.length===0?!1:b&&c.indexOf(b)>-1?!0:b?!1:!0:!1},c.prototype.proxy=function(a,b){return this.on(a,d.call(this,a,b)),this},c.prototype.unproxy=function(a,b){return this.off(a,d.call(this,a,b)),this},c.prototype.bind=function(a,b,c){"string"!=typeof b&&(c=b,b=null);var e=!b||!this._drip.delimeter?a:Array.isArray(b)?b.concat(a):b.split(this._drip.delimeter).concat(a);c.on(a,d.call(this,e,this))},c.prototype.unbind=function(a,b,c){"string"!=typeof b&&(c=b,b=null);var e=!b||!this._drip.delimeter?a:Array.isArray(b)?b.concat(a):b.split(this._drip.delimeter).concat(a);c.removeListener(a,d.call(this,e,this))},b})