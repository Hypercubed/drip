/*!
 * drip - Node.js event emitter.
 * Copyright(c) 2011 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */

!function(a,b){typeof module!="undefined"?module.exports=b():typeof define=="function"&&typeof define.amd=="object"?define(b):this[a]=b()}("drip",function(){function c(a){a&&(this._drip={},this._drip.delimeter=a.delimeter||":",this._drip.wildcard=a.wildcard||(a.delimeter?!0:!1),this.on=e,this.off=g,this.emit=i)}function d(){var a=this._events||(this._events={}),b=arguments[0],c=arguments[1];return a[b]?"function"==typeof a[b]?a[b]=[a[b],c]:a[b].push(c):a[b]=c,this}function e(){function f(a,b){var d=a.shift();b[d]=b[d]||{},a.length?f(a,b[d]):b[d]._?b[d]._.push(c):b[d]._=[c]}var a=this._events||(this._events={}),b=arguments[0],c=arguments[1],d=Array.isArray(b)?b.slice(0):b.split(this._drip.delimeter),e=this._events||(this._events={});return f(d,e),this}function f(a,b){if(!this._events||arguments.length==0)return this._events={},this;if(!b)return this._events[a]=null,this;var c=this._events[a];if(!c)return this;if("function"==typeof c&&c==b)this._events[a]=null;else{for(var d=0;d<c.length;d++)c[d]==b&&c.splice(d,1);c.length===0?this._events[a]=null:c.length===1&&(this._events[a]=c[0])}return this}function g(a,b){if(!this._events||arguments.length===0)return this._events={},this;var c=Array.isArray(a)?a.slice(0):a.split(this._drip.delimeter);if(c.length===1&&!b)return this._events[a]&&(this._events[a]._=null),this;function d(a){for(var b in a)if(a[b]&&b!="_")return!1;return!0}function e(a){if(b&&"function"==typeof b){for(var c=0;c<a._.length;c++)b==a._[c]&&a._.splice(c,1);a._.length===0&&(a._=null),a._&&a._.length==1&&(a._=a._[0])}else a._=null;return!a._&&d(a)&&(a=null),a}function f(a,b){var c=a.shift();return b[c]&&b[c]._&&!a.length&&(b[c]=e(b[c])),b[c]&&a.length&&(b[c]=f(a,b[c])),!b[c]&&d(b)&&(b=null),b}return this._events=f(c,this._events),this}function h(){if(!this._events)return!1;var a=arguments[0],b=this._events[a];if(!b)return!1;if("function"==typeof b)if(arguments.length==1)b.call(this);else if(arguments.length==2)b.call(this,arguments[1]);else if(arguments.length==3)b.call(this,arguments[1],arguments[2]);else{var c=arguments.length,d=Array(c-1);for(var e=1;e<c;e++)d[e-1]=arguments[e];b.apply(this,d)}else{var d;for(var e=0,c=b.length;e<c;e++)if(arguments.length===1)b[e].call(this);else if(arguments.length===2)b[e].call(this,arguments[1]);else if(arguments.length===3)b[e].call(this,arguments[1],arguments[2]);else{if(!d){var c=arguments.length;d=Array(c-1);for(var f=1;f<c;f++)d[f-1]=arguments[f]}b[e].apply(this,d)}}return!0}function i(){function d(a,c){var e=a.shift();if(e!=="*"&&c[e]&&c[e]._&&!a.length)if("function"==typeof c[e]._)b.push(c[e]._);else{var f=b.length,g=c[e]._.length,h=Array(f+g);for(var i=0;i<f;i++)h[i]=b[i];for(var j=0;j<g;j++)h[i+j]=c[e]._[j];b=h}if(c["*"]&&c["*"]._&&!a.length)if("function"==typeof c["*"]._)b.push(c["*"]._);else{var f=b.length,g=c["*"]._.length,h=Array(f+g);for(var i=0;i<f;i++)h[i]=b[i];for(var j=0;j<g;j++)h[i+j]=c["*"]._[j];b=h}if(a.length&&(c[e]||c["*"])){var k=a.length,l=Array(k),m=Array(k);for(var i=0;i<k;i++)l[i]=a[i],m[i]=a[i];c[e]&&d(l,c[e]),c["*"]&&d(m,c["*"])}}if(!this._events)return!1;var a=arguments[0],b=[],c=Array.isArray(a)?a.slice(0):a.split(this._drip.delimeter);d(c,this._events);if(!b.length)return!1;var e;for(var f=0,g=b.length;f<g;f++)if(arguments.length===1)b[f].call(this);else if(arguments.length===2)b[f].call(this,arguments[1]);else if(arguments.length===3)b[f].call(this,arguments[1],arguments[2]);else{if(!e){var h=arguments.length;e=Array(h-1);for(var i=1;i<h;i++)e[i-1]=arguments[i]}b[f].apply(this,e)}return!0}function j(a,b){var c=this._drip||(this._drip={}),d=c.memoize||(c.memoize={}),e=c.delimeter&&Array.isArray(a)?a.join(c.delimeter):a,f=d[e],g=null;if(!f)g=k(e,b),d[e]=[[b,g]];else{for(var h=0,i=f.length;h<i;h++)if(f[h][0]===b)return f[h][1];g=k(e,b),f.push([b,g])}return g}function k(a,b){return function(){var d=Array.prototype.slice.call(arguments),e=[a].concat(d);b.emit.apply(b,e)}}var a={},b=a.exports=c;return b.version="0.2.4",c.prototype.on=d,c.prototype.many=function(a,b,c){function e(){--b===0&&d.off(a,e),c.apply(null,arguments)}var d=this;return this.on(a,e),this},c.prototype.once=function(a,b){return this.many(a,1,b),this},c.prototype.off=f,c.prototype.removeListener=c.prototype.off,c.prototype.removeAllListeners=c.prototype.off,c.prototype.emit=h,c.prototype.has=function(a,b){if(!this._events)return!1;var a=arguments[0],c;if(!this._drip||this._drip&&!this._drip.wildcard)c=this._events[a];else{var d=Array.isArray(a)?a.slice(0):a.split(this._drip.delimeter);function e(a,b){var d=a.shift();d!=="*"&&b[d]&&b[d]._&&!a.length&&("function"==typeof b[d]._?c.push(b[d]._):c=c.concat(b[d]._)),b["*"]&&b["*"]._&&!a.length&&("function"==typeof b["*"]._?c.push(b["*"]._):c=c.concat(b["*"]._)),a.length&&(b[d]&&e(a.slice(0),b[d]),b["*"]&&e(a.slice(0),b["*"]))}c=[],e(d,this._events)}return c?!b&&"function"==typeof c?!0:b&&"function"==typeof c&&b==c?!0:c.length===0?!1:b&&c.indexOf(b)>-1?!0:b?!1:!0:!1},c.prototype.proxy=function(a,b){return this.on(a,j.call(this,a,b)),this},c.prototype.unproxy=function(a,b){return this.off(a,j.call(this,a,b)),this},c.prototype.bind=function(a,b,c){"string"!=typeof b&&(c=b,b=null);var d=!b||!this._drip.delimeter?a:Array.isArray(b)?b.concat(a):b.split(this._drip.delimeter).concat(a);c.on(a,j.call(this,d,this))},c.prototype.unbind=function(a,b,c){"string"!=typeof b&&(c=b,b=null);var d=!b||!this._drip.delimeter?a:Array.isArray(b)?b.concat(a):b.split(this._drip.delimeter).concat(a);c.removeListener(a,j.call(this,d,this))},b})