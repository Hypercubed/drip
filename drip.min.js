/*!
 * drip - Node.js event emitter.
 * Copyright(c) 2011 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */

!function(a,b){typeof module!="undefined"?module.exports=b():typeof define=="function"&&typeof define.amd=="object"?define(b):this[a]=b()}("drip",function(){function c(a){a&&(this._drip={},this._drip.delimeter=a.delimeter||":",this._drip.wildcard=a.wildcard||(a.delimeter?!0:!1))}function d(){var a=arguments[0],b;if(!this._drip||this._drip&&!this._drip.wildcard)b=this._events[a];else if(this._drip&&this._drip.wildcard){var c=Array.isArray(a)?a:a.split(this._drip.delimeter);b=[];function d(a,c){var e=a.shift();c[e]&&c[e]._&&!a.length&&("function"==typeof c[e]._?b.push(c[e]._):b=b.concat(c[e]._)),c["*"]&&c["*"]._&&!a.length&&("function"==typeof c["*"]._?b.push(c["*"]._):b=b.concat(c["*"]._)),a.length&&(c[e]&&d(a.slice(0),c[e]),c["*"]&&d(a.slice(0),c["*"]))}d(c,this._events)}return b}var a={},b=a.exports=c;return b.version="0.2.4",c.prototype.on=function(a,b){if(!this._drip||this._drip&&!this._drip.wildcard){var c=this._events||(this._events={});c[a]?c[a].push(b):c[a]=[b]}else if(this._drip&&this._drip.wildcard){var d=Array.isArray(a)?a:a.split(this._drip.delimeter),e=this._events||(this._events={});function f(a,c){var d=a.shift();c[d]=c[d]||{},a.length?f(a,c[d]):c[d]._?c[d]._.push(b):c[d]._=[b]}f(d,e)}return this},c.prototype.many=function(a,b,c){function e(){--b===0&&d.off(a,e),c.apply(null,arguments)}var d=this;return this.on(a,e),this},c.prototype.once=function(a,b){return this.many(a,1,b),this},c.prototype.off=function(a,b){if(!this._events||arguments.length===0)return this._events={},this;if(!this._drip||this._drip&&!this._drip.wildcard){if("function"!=typeof b)return this._events[a]=null,this;var c=this._events[a];if(!c)return this;if("function"==typeof c&&c==b)this._events[a]=null;else if(Array.isArray(c)){for(var d=0;d<c.length;d++)c[d]==b&&c.splice(d,1);c.length===0?this._events[a]=null:c.length===1&&(this._events[a]=c[0])}}else{var e=Array.isArray(a)?a:a.split(this._drip.delimeter);if(e.length===1)return this._events[a]&&(this._events[a]._=null),this;function f(a){for(var b in a)if(a[b]&&b!="_")return!1;return!0}function g(a){if(b&&"function"==typeof b){for(var c=0;c<a._.length;c++)b==a._[c]&&a._.splice(c,1);a._.length===0&&(a._=null),a._&&a._.length==1&&(a._=a._[0])}else a._=null;return!a._&&f(a)&&(a=null),a}function h(a,b){var c=a.shift();return b[c]&&b[c]._&&!a.length&&(b[c]=g(b[c])),b[c]&&a.length&&(b[c]=h(a,b[c])),!b[c]&&f(b)&&(b=null),b}this._events=h(e,this._events)}return this},c.prototype.removeAllListeners=c.prototype.off,c.prototype.emit=function(){if(!this._events)return this;var a=arguments[0],b=d.call(this,a);if("function"==typeof b)if(arguments.length===1)b.call(this);else if(arguments.length===2)b.call(this,arguments[1]);else if(arguments.length===3)b.call(this,arguments[1],arguments[2]);else{var c=arguments.length,e=new Array(c-1);for(var f=1;f<c;f++)e[f-1]=arguments[f];b.apply(this,e)}else{var g=arguments.length,e=new Array(g-1);for(var h=1;h<g;h++)e[h-1]=arguments[h];for(var f=0,c=b.length;f<c;f++)e.length===0?b[f].call(this):e.length===1?b[f].call(this,e[0]):e.length===2?b[f].call(this,e[0],e[1]):b[f].apply(this,e)}return this},c.prototype.has=function(){if(!this._events)return!1;var a=arguments[0],b=d.call(this,a);return b.length>0},c.prototype.proxyEvent=function(a,b,c){c=c||b,this.on(a,function(){var d=Array.prototype.slice.call(arguments),e=[a].concat(d);b.emit.apply(c,e)})},b})